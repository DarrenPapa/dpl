object State

method :State new value
    new :self tmp
    set tmp.value :value
    set tmp.funcs !list
    return :tmp
end

method :State set new_value
    set self.value :new_value
    self.update
end

method :State update
    for func in :self.funcs
        func :self
    end
end

method :State add_func func
    pass [:self.funcs@append :func]
end